<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>PWA 아이콘 생성기 - 용인대학교</title>
  <style>
    body { font-family: 'Noto Sans KR', sans-serif; padding: 2rem; background: #1e293b; color: #e2e8f0; }
    h1 { margin-bottom: 0.5rem; }
    .subtitle { color: #94a3b8; margin-bottom: 1.5rem; }
    .icons { display: flex; flex-wrap: wrap; gap: 1.5rem; margin-top: 1.5rem; }
    .icon-item { text-align: center; }
    .icon-item p { color: #94a3b8; margin-top: 0.5rem; font-size: 0.875rem; }
    canvas { border: 1px solid #334155; border-radius: 12px; background: white; }
    .buttons { display: flex; gap: 0.75rem; margin-top: 1.5rem; }
    button { padding: 0.75rem 1.5rem; color: white; border: none; border-radius: 0.5rem; cursor: pointer; font-size: 1rem; }
    .btn-primary { background: #166a6a; }
    .btn-primary:hover { background: #0f5454; }
    .btn-secondary { background: #475569; }
    .btn-secondary:hover { background: #374151; }
    .status { margin-top: 1rem; color: #10b981; font-size: 0.875rem; }
    .loading { color: #f59e0b; }
    .preview-logo { max-width: 200px; border-radius: 12px; border: 1px solid #334155; background: white; padding: 1rem; }
  </style>
</head>
<body>
  <h1>PWA 아이콘 생성기</h1>
  <p class="subtitle">용인대학교 로고 기반 아이콘을 생성합니다.</p>

  <div>
    <p style="color:#94a3b8; margin-bottom: 0.5rem;">원본 로고:</p>
    <img id="logoPreview" class="preview-logo" src="logo-original.png" alt="용인대학교 로고">
  </div>

  <div class="buttons">
    <button class="btn-primary" onclick="downloadAll()">모든 아이콘 다운로드</button>
    <button class="btn-secondary" onclick="downloadAll(true)">마스커블 아이콘 다운로드</button>
  </div>
  <div id="status" class="status"></div>

  <div class="icons" id="iconContainer"></div>

  <script>
    const sizes = [72, 96, 128, 144, 152, 192, 384, 512];
    const container = document.getElementById('iconContainer');
    const statusEl = document.getElementById('status');
    const logoImg = new Image();
    let logoLoaded = false;

    logoImg.onload = function() {
      logoLoaded = true;
      statusEl.textContent = '로고 로드 완료! 아이콘을 생성합니다...';
      renderAllIcons();
      statusEl.textContent = '아이콘 생성 완료! 다운로드 버튼을 클릭하세요.';
    };

    logoImg.onerror = function() {
      statusEl.textContent = 'logo-original.png 파일을 찾을 수 없습니다. 같은 폴더에 파일이 있는지 확인하세요.';
      statusEl.classList.add('loading');
    };

    logoImg.src = 'logo-original.png';

    /**
     * 아이콘 그리기
     * - 흰색 둥근 배경
     * - 로고를 중앙에 패딩 포함하여 배치
     * - maskable: 안전 영역(80%) 내에 로고 배치
     */
    function drawIcon(canvas, size, maskable) {
      const ctx = canvas.getContext('2d');
      canvas.width = size;
      canvas.height = size;

      // 흰색 배경
      ctx.fillStyle = '#ffffff';
      if (maskable) {
        // 마스커블: 전체 사각형 (OS가 잘라줌)
        ctx.fillRect(0, 0, size, size);
      } else {
        // 일반: 둥근 사각형
        const r = size * 0.18;
        ctx.beginPath();
        ctx.moveTo(r, 0);
        ctx.lineTo(size - r, 0);
        ctx.quadraticCurveTo(size, 0, size, r);
        ctx.lineTo(size, size - r);
        ctx.quadraticCurveTo(size, size, size - r, size);
        ctx.lineTo(r, size);
        ctx.quadraticCurveTo(0, size, 0, size - r);
        ctx.lineTo(0, r);
        ctx.quadraticCurveTo(0, 0, r, 0);
        ctx.closePath();
        ctx.fill();
      }

      if (!logoLoaded) return;

      // 로고 비율 계산
      const logoW = logoImg.naturalWidth;
      const logoH = logoImg.naturalHeight;
      const ratio = logoW / logoH;

      // 패딩: 일반 15%, 마스커블 25% (안전 영역)
      const padding = maskable ? size * 0.25 : size * 0.12;
      const available = size - padding * 2;

      let drawW, drawH;
      if (ratio > 1) {
        drawW = available;
        drawH = available / ratio;
      } else {
        drawH = available;
        drawW = available * ratio;
      }

      const x = (size - drawW) / 2;
      const y = (size - drawH) / 2;

      ctx.drawImage(logoImg, x, y, drawW, drawH);
    }

    function renderAllIcons() {
      container.innerHTML = '';

      sizes.forEach(size => {
        const div = document.createElement('div');
        div.className = 'icon-item';

        const canvas = document.createElement('canvas');
        canvas.id = `icon-${size}`;
        drawIcon(canvas, size, false);

        const label = document.createElement('p');
        label.textContent = `${size}x${size}`;

        div.appendChild(canvas);
        div.appendChild(label);
        container.appendChild(div);
      });
    }

    function downloadAll(maskable) {
      if (!logoLoaded) {
        statusEl.textContent = '로고가 아직 로드되지 않았습니다.';
        statusEl.classList.add('loading');
        return;
      }

      const prefix = maskable ? 'maskable-' : '';
      statusEl.textContent = '다운로드 중...';

      sizes.forEach((size, i) => {
        setTimeout(() => {
          const canvas = document.createElement('canvas');
          drawIcon(canvas, size, !!maskable);

          const link = document.createElement('a');
          link.download = `${prefix}icon-${size}.png`;
          link.href = canvas.toDataURL('image/png');
          link.click();

          if (i === sizes.length - 1) {
            statusEl.textContent = `${sizes.length}개 아이콘 다운로드 완료!`;
          }
        }, i * 300);
      });
    }
  </script>
</body>
</html>
